# TIL (2023.06.23)

## DAY 16

오늘 읽은 범위: 시작 - 5장) any 다루기 - 아이템 41 ~ 아이템 44

---

```text
😉 책에서 기억하고 싶은 내용을 써보세요.
```

### 아이템 41 any의 진화를 이해하기

- 초기 any[]로 선언되었지만 number 타입의 값을 넣는 순간부터 타입은 number[]로 진화합니다.
  타입의 진화는 타입 좁히기와 다릅니다. 배열에 다양한 타입의 요소를 넣으면 배열의 타입이 확장되며 진화합니다.
- 조건문에서는 분기에 따라 타입이 변할 수도 있습니다.
- 변수의 초깃값이 null인 경우도 any의 진화가 일어납니다.
- 그러나 명시적으로 any를 선언하면(:any) 타입이 그대로 유지됩니다.
- 암시적 any 타입은 함수 호출을 거쳐도 진화하지 않습니다.

```text
function makeSquares(start: number, limit: number) {
  const out = [];
  // ~~~ 'out' 변수는 일부 위치에서 암시적으로 'any[]' 형식입니다.
range(start, limit).forEach(i => {
  out.push(i * i);
});
return out;
  // ~~~ 'out' 변수에는 암시적으로 'any[]' 형식이 포함됩니다.
}
```

- 타입을 안전하게 지키기 위해서는 암시적 any를 진화시키는 방식보다 명시적 타입 구문을 사용하는 것이 더 좋은 설계입니다.

### 아이템 42 모르는 타입의 값에는 any 대신 unknown을 사용하기

- unknown은 any 대신 쓸 수 있는 타입 시스템에 부합하는 타입입니다. unknown 타입은 앞에서 언급한 any의 첫 번쨰 속성(어떠한 타입이든 unknown에 할당 가능)을 만족하지만,
  두 번째 속성(unknown은 오직 unknown과 any에만 할당 가능)은 만족하지 않습니다.
- unknown 그대로 값을 사용할 수 없기 때문에 타입 단언을 해야합니다.
- 제너릭을 사용한 스타일은 타입 단언문과 달라 보이지만 기능적으로는 동일합니다. 제너릭보다는 unknown을 반환하고 사용자가 직접 단언문을 사용하거나
  원하는 대로 타입을 좁히도록 강제하는 것이 좋습니다.
- 두 개의 단언문을 분리하는 리팩터링을 한다면 unknown 형태가 더 안전합니다. 분리되는 즉시 오류를 발생하게 되므로 더 안전합니다.

```text
  let barAny = foo as any as Bar;
  let barUnk = foo as unknown as Bar;
```

### 아이템 43 몽키 패치보다는 안전한 타입을 사용하기

- 전역 변수를 사용하면 은연중에 프로그램 내에서 서로 멀리 떨어진 부분들 간에 의존성을 만들게 됩니다. 그러면 함수를 호출할 때마다 부작용을 고려해야만 합니다.
- interface의 특수 기능 중 하나인 보강을 사용
  - 보강을 사용한 방법이 any보다 나은 점
    - 타입이 더 안전합니다.
    - 속성에 주석을 붙일 수 있다.
    - 속성에 자동완성을 사용할 수 있다.
    - 몽키 패치가 어떤 부분에 적용되었는지 정확한 기록이 남는다.
- 더 구체적인 타입 단언문을 사용
- 몽키 패치를 남용해서는 안 되며 궁극적으로 더 잘 설계된 구조로 리팩터링하는 것이 좋습니다.

### 아이템 44 타입 커버리지를 추적하여 타입 안전성 유지하기

- any 타입이 여전히 프로그램 내에 존재할 수 있는 두 가지 경우
  - 명시적 any 타입
  - 서드파티 타입 선언
- any 타입은 타입 안전성과 생산성에 부정적 영향을 미칠 수 있으므로, 프로젝트에서 any의 개수를 추적하는 것이 좋습니다.
  - npx type-coverage
- 나중에 라이브러리가 업데이트되어 함수의 선언믄이 제대로 수정된다면 any를 제거해야 합니다.
- any 타입이 사용되는 코드가 실제로는 더 이상 실행되지 않는 코드일 수 있습니다.

```text
🤔 오늘 익은 소감은? 떠오르는 생각을 가볍게 적어보세요
```

- npx type-coverage

```text
146764 / 151539 96.84%
type-coverage success.
```

```text
궁금한 내용이 있거나, 잘 이해되지 않는 내용이 있다면 적어보세요.
```
